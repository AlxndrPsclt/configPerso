#!/bin/sh

# Function to show usage
show_usage() {
    echo "Usage: $0 [-c|--colors]"
    echo "  -c, --colors       Enable colored output for host status"
}

# Check for arguments
USE_COLORS=false
for arg in "$@"; do
    case $arg in
        -c|--colors)
            USE_COLORS=true
            shift # Remove argument from processing
            ;;
        *)
            show_usage
            exit 1
            ;;
    esac
done

# YAML file with hosts
yaml_file="/home/alex/.config/perso/edgevpn/hosts.yaml"

# ANSI color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Begin output
echo "hosts_status:"

# Read each host and ping
cat "$yaml_file" | while read -r line; do
    case "$line" in
        *"- "*) 
            host=$(echo "$line" | cut -d ' ' -f 2)
            if ping -c 1 -W 1 "$host" > /dev/null 2>&1; then
                echo "  - host: $host"
                if [ "$USE_COLORS" = true ]; then
                    echo -e "    status: ${GREEN}up${NC}"
                else
                    echo "    status: up"
                fi
            else
                echo "  - host: $host"
                if [ "$USE_COLORS" = true ]; then
                    echo -e "    status: ${RED}down${NC}"
                else
                    echo "    status: down"
                fi
            fi
            ;;
    esac
done

